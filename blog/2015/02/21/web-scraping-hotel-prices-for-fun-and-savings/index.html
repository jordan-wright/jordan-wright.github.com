<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="og:title" content="Web Scraping Hotel Prices for Fun and Savings &#183; Jordan Wright"><meta property="og:site_name" content="Jordan Wright"><meta property="og:url" content="https://jordan-wright.com/blog/2015/02/21/web-scraping-hotel-prices-for-fun-and-savings/"><meta property="og:type" content="article"><meta property="og:article:published_time" content="2015-02-21T00:00:00Z"><meta property="og:article:tag" content="python"><meta property="og:article:tag" content="web_scraping"><title>Web Scraping Hotel Prices for Fun and Savings &#183; Jordan Wright</title><meta name=description content="Security and Programming Blog"><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://jordan-wright.com/blog/images/favicon.ico><link rel=apple-touch-icon href=https://jordan-wright.com/blog/images/apple-touch-icon.png><link rel=stylesheet type=text/css href=https://jordan-wright.com/blog/css/screen.css><link rel=stylesheet type=text/css href=https://jordan-wright.com/blog/css/highlight.css><link rel=stylesheet type=text/css href=https://jordan-wright.com/blog/css/nav.css><link rel=stylesheet type=text/css href=https://jordan-wright.com/blog/css/fonts.css><link href=https://jordan-wright.com/blog/index.xml rel=alternate type=application/rss+xml title="Jordan Wright"><meta name=generator content="Hugo 0.154.5"><link rel=canonical href=https://jordan-wright.com/blog/2015/02/21/web-scraping-hotel-prices-for-fun-and-savings/><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-44718701-1","auto"),ga("send","pageview")</script></head><body class=nav-closed><div class=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Close</span></a><ul><li class=nav-opened role=presentation><a href=https://jordan-wright.com/>Home</a></li><li class=nav-opened role=presentation><a href=https://jordan-wright.com/contact/>Contact</a></li><li class=nav-opened role=presentation><a href=https://jordan-wright.com/projects/>Projects</a></li><li class=nav-opened role=presentation><a href=https://jordan-wright.com/blog/>Blog</a></li><li class=nav-opened role=presentation><a href=https://raidersec.blogspot.com>Raidersec</a></li></ul><a class="subscribe-button icon-feed" href=https://jordan-wright.com/blog/index.xml>Subscribe</a></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head no-cover"><nav class="main-nav clearfix"><a class=menu-button href=#><span class=burger>&#9776;</span><span class=word>Menu</span></a></nav></header><main class=content role=main><article class="post post"><header class=post-header><h1 class=post-title>Web Scraping Hotel Prices for Fun and Savings</h1><small></small><section class=post-meta><time class=post-date datetime=2015-02-21T00:00:00Z>Feb 21, 2015
</time><span class="post-tag small"><a href=https://jordan-wright.com/blog/tags/python/>#python</a></span>
<span class="post-tag small"><a href=https://jordan-wright.com/blog/tags/web_scraping/>#web_scraping</a></span></section></header><section class=post-content><img src=/blog/images/headers/web_scraping.png alt class=pure-img><h3 id=introduction>Introduction</h3><p>During the process of planning a vacation, I came across a nice hotel I wanted to stay at. When looking at some possible dates, I noticed the nightly rate would fluctuate <em>dramatically</em>. This made me question if I was going to wind up paying way more just because I wanted to stay at the hotel on a certain day.</p><p>Then I considered the alternative - maybe I could scrape the prices every day to find the cheapest nightly rate. Sounded like a job for Python, BeautifulSoup, and some whiskey.</p><h3 id=a-brief-intro-to-python-web-scraping>A Brief Intro to Python Web Scraping</h3><p>Web scraping with Python is generally done using a mixture of the fantastic <code>requests</code> and <code>beautifulsoup</code> libraries. This post won&rsquo;t go into detail about all the neat features of <code>beautifulsoup</code>, instead aiming for simplicity to show the basics.</p><h4 id=getting-a-beautifulsoup-object>Getting a BeautifulSoup Object</h4><p>The first step in web scraping is getting the HTML you want, and creating a parseable object out of it. We can do this by requesting a page with <code>requests.get()</code> and, if successful, creating a BeautifulSoup object using the <code>BeautifulSoup()</code> constructor with the <code>.text</code> of our response.</p><p>It would look something like this:</p><pre tabindex=0><code>response = requests.get(&#39;http://foo.bar&#39;)
if response.ok:
    soup = BeautifulSoup(response.text)
</code></pre><h4 id=getting-data-from-beautifulsoup>Getting Data From BeautifulSoup</h4><p>Now that we have a BeautifulSoup object, we can use its API to get the data we want. The first step is to parse out the <code>Tag</code> object we are interested in. Then, we can parse out the text/attributes we want. Here are some examples of getting specific tags:</p><pre tabindex=0><code>soup.find_all(&#39;a&#39;) # Get all &lt;a&gt; tags
soup.find_all(&#39;a&#39;, {&#34;class&#34; : &#34;css_class&#34;}) # Get all &lt;a class=&#34;css_class&#34;&gt; tags
soup.find_all(&#39;a&#39;, &#39;css_class&#39;) # Shortcut for searching by class
soup.find() # Same as find_all(), but returns the first instance
</code></pre><p>After we have the <code>Tag</code> object we want, we can parse out the text by accessing the <code>.text</code> attribute.</p><p>This is <em>barely</em> scratching the surface of BeautifulSoup&rsquo;s API, so if you&rsquo;re interested in learning more, you can take a look at the docs <a href=http://www.crummy.com/software/BeautifulSoup/bs4/doc/>here</a>. That&rsquo;s all we&rsquo;ll need for this post, so let&rsquo;s see this in action.</p><h3 id=parsing-some-not-great-html>Parsing Some (Not Great) HTML</h3><p>The goal was to simply pull down the rate for each day, and dump it out to a CSV (&ldquo;rates.csv&rdquo;) for some sweet Excel graphing later.</p><p>I&rsquo;ll leave the exact hotel and URL redacted, but the basic URL was in the form:</p><pre tabindex=0><code>http://foo.bar?month=:int&amp;day=:int&amp;year=:int
</code></pre><p>We can start with a naive approach of looping through the months I was interested in (August through December) and getting a BeautifulSoup object from each result.</p><pre tabindex=0><code>import requests
from bs4 import BeautifulSoup
import time

with open(&#39;rates.csv&#39;, &#39;w&#39;) as rates:
    rates.write(&#34;Date,Rate\n&#34;)
    for m in range(8,13):
        for d in range(1,32):
            try:
                response = requests.get(&#39;http://foo.bar?month=&#39; + str(m) + &#39;&amp;day=&#39; + str(d) + &#39;&amp;year=2015&#39;)
                if response.ok:
                    soup = BeautifulSoup(response.text)
            except Exception e:
                print e
            # Be (somewhat) nice.
            time.sleep(.2)
</code></pre><p>Now we just need to figure out what kind of data we care about. This site used tables. <strong>A lot.</strong> After some testing, I wound up parsing HTML that looked like this:</p><pre tabindex=0><code>&lt;table summary=&#34;rooms availability&#34;&gt;
    &lt;tbody&gt;
        &lt;tr&gt;
            &lt;td&gt;
                &lt;div class=&#34;roomSection&#34;&gt;
                    &lt;div class=&#34;roomType&#34;&gt;
                        &lt;span class=&#34;value&#34;&gt;King&lt;/span&gt;
                    &lt;/div&gt;
                    &lt;div class=&#34;roomAvail&#34;&gt;
                        &lt;div class=&#34;bar&#34;&gt;
                            &lt;div class=&#34;label&#34;&gt;Nightly Rate&lt;/div&gt;
                            &lt;div class=&#34;value&#34;&gt;
                                159.00 &lt;-- What I want to get
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/tbody&gt;
&lt;/table&gt;
</code></pre><p>I cleaned up the formatting, removed unnecessary parts, etc. Trust me, you&rsquo;re welcome.</p><p>My first step was to get the room type and make sure it was &ldquo;King&rdquo; as a sanity check, since there were multiple types of rooms in the table. Then, I wanted to get the text of the div with the class &ldquo;value&rdquo; in the &ldquo;roomAvail&rdquo; section. This is the nightly rate.</p><p>Finally, I want to write the rate out to the CSV file.</p><p>There&rsquo;s definitely more concise ways of doing this with more advanced BeautifulSoup usage, but this code worked:</p><pre tabindex=0><code>king = soup.find(&#34;table&#34;, {&#34;summary&#34; : &#34;rooms availability&#34;}).find(&#34;div&#34;, &#34;roomSection&#34;)
if king.find(&#34;div&#34;, &#34;roomType&#34;).text.strip() == &#34;King&#34;:
    rate = king.find(&#34;div&#34;, &#34;roomAvail&#34;).find(&#34;div&#34;, &#34;value&#34;).strip()
    rates.write(&#34;2015-&#34; + str(m) + &#34;-&#34; + str(d) + &#34;,&#34; + str(rate) + &#34;\n&#34;)
</code></pre><h3 id=success>Success!</h3><p>Running the script outputs the results just as I wanted them and, graphed in Excel, looks like this:</p><img src="/blog/images/blog/web scraping/rates.png"><p><em>Awesome.</em> In just a few lines of Python, I was able to get data allowing me to plan a vacation while saving quite a bit of cash.</p></section><footer class=post-footer><figure class=author-image><a class=img href=https://jordan-wright.com/blog/ style=background-image:url(https://jordan-wright.com/blog/images/jordan-profile.jpg)><span class=hidden>Jordan Wright's Picture</span></a></figure><section class=author><h4><a href=https://jordan-wright.com/blog/>Jordan Wright</a></h4><p>Security Researcher, Open-Source Developer.</p><div class=author-meta><span class="author-location icon-location">Texas</span></div></section><section class=share><h4>Share this post</h4><a class=share-link href="https://twitter.com/intent/tweet?text=Web%20Scraping%20Hotel%20Prices%20for%20Fun%20and%20Savings&nbsp;-&nbsp;Jordan%20Wright&amp;url=https%3a%2f%2fjordan-wright.com%2fblog%2f2015%2f02%2f21%2fweb-scraping-hotel-prices-for-fun-and-savings%2f" onclick='return window.open(this.href,"x-share","width=550,height=235"),!1'><svg class="share-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M18.244 2.25h3.308l-7.227 8.26 8.503 11.24h-6.68l-5.23-6.84-6.02 6.84H1.59l7.73-8.812L1.16 2.25h6.85l4.73 6.25 5.504-6.25zm-1.16 17.52h1.833L6.71 4.126H4.745L17.084 19.77z"/></svg>
<span class=hidden>X</span>
</a><a class=share-link href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fjordan-wright.com%2fblog%2f2015%2f02%2f21%2fweb-scraping-hotel-prices-for-fun-and-savings%2f&amp;t=Web%20Scraping%20Hotel%20Prices%20for%20Fun%20and%20Savings" onclick='return window.open(this.href,"hn-share","width=600,height=400"),!1'><svg class="share-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path fill-rule="evenodd" d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
<span class=hidden>Hacker News</span>
</a><a class=share-link href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fjordan-wright.com%2fblog%2f2015%2f02%2f21%2fweb-scraping-hotel-prices-for-fun-and-savings%2f" onclick='return window.open(this.href,"linkedin-share","width=600,height=500"),!1'><svg class="share-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.6.0 4.264 2.37 4.264 5.455v6.286zM5.337 7.433a2.062 2.062.0 110-4.123 2.062 2.062.0 010 4.123zM6.814 20.452H3.861V9h2.953v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0z"/></svg>
<span class=hidden>LinkedIn</span></a></section></footer></article></main></div><script type=text/javascript src=https://jordan-wright.com/blog/js/jquery.js defer></script><script type=text/javascript src=https://jordan-wright.com/blog/js/index.js defer></script></body></html>