<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" CSAW CTF 2015 - Forensics 100 Transfer Writeup &middot;  Jordan Wright" />
  	<meta property="og:site_name" content="Jordan Wright" />
  	<meta property="og:url" content="https://jordan-wright.com/blog/2015/09/22/csaw-ctf-2015-forensics-100-transfer-writeup/" />

    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2015-09-22T19:05:18Z" />

    
    <meta property="og:article:tag" content="csaw2015" />
    
    <meta property="og:article:tag" content="writeup" />
    
    <meta property="og:article:tag" content="ctf" />
    
    

  <title>
     CSAW CTF 2015 - Forensics 100 Transfer Writeup &middot;  Jordan Wright
  </title>

    <meta name="description" content="Security and Programming Blog" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://jordan-wright.com/blog/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://jordan-wright.com/blog/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="https://jordan-wright.com/blog/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://jordan-wright.com/blog/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="https://jordan-wright.com/blog/index.xml" rel="alternate" type="application/rss+xml" title="Jordan Wright" />
      
      
    
    <meta name="generator" content="Hugo 0.40.3" />

    <link rel="canonical" href="https://jordan-wright.com/blog/2015/09/22/csaw-ctf-2015-forensics-100-transfer-writeup/" />

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-44718701-1', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://jordan-wright.com/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://jordan-wright.com/contact/">Contact</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://jordan-wright.com/projects/">Projects</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://jordan-wright.com/blog/">Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://raidersec.blogspot.com">Raidersec</a>
            </li>
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="https://jordan-wright.com/blog/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">CSAW CTF 2015 - Forensics 100 Transfer Writeup</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2015-09-22T19:05:18Z">
            Sep 22, 2015
          </time>
        
         
          <span class="post-tag small"><a href="https://jordan-wright.com/blog/tags/csaw2015/">#csaw2015</a></span>
         
          <span class="post-tag small"><a href="https://jordan-wright.com/blog/tags/writeup/">#writeup</a></span>
         
          <span class="post-tag small"><a href="https://jordan-wright.com/blog/tags/ctf/">#ctf</a></span>
         
        </section>
    </header>

    <section class="post-content">
      <img src="/blog/images/headers/csaw_100.png" alt="" class="pure-img" >


<p>This challenge starts off with the following hint:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">I was sniffing some web traffic for a while, I think i finally got something interesting. Help me find flag through all these packets.</code></pre></div>
<p>This challenge started off with a pcap. Let&rsquo;s take the cheap way out and do a basic Wireshark filter for <code>frame contains flag</code>:

<img src="/blog/images/blog/csaw2015/frame_contains.png"></p>

<p>Awesome - looks like we found a packet. Following the TCP stream reveals a Python script (formatted - you&rsquo;re welcome) and what appears to be the output of the script:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2838b0">import</span> <span style="color:#289870">string</span>
<span style="color:#2838b0">import</span> <span style="color:#289870">random</span>
<span style="color:#2838b0">from</span> <span style="color:#289870">base64</span> <span style="color:#2838b0">import</span> b64encode<span style="color:#888">,</span> b64decode

FLAG <span style="color:#666">=</span> <span style="color:#b83838">&#39;flag{xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx}&#39;</span>

enc_ciphers <span style="color:#666">=</span> <span style="color:#888">[</span><span style="color:#b83838">&#39;rot13&#39;</span><span style="color:#888">,</span> <span style="color:#b83838">&#39;b64e&#39;</span><span style="color:#888">,</span> <span style="color:#b83838">&#39;caesar&#39;</span><span style="color:#888">]</span>
<span style="color:#888;font-style:italic"># dec_ciphers = [&#39;rot13&#39;, &#39;b64d&#39;, &#39;caesard&#39;]</span>

<span style="color:#2838b0">def</span> <span style="color:#785840">rot13</span><span style="color:#888">(</span>s<span style="color:#888">):</span>
    _rot13 <span style="color:#666">=</span> string<span style="color:#666">.</span>maketrans<span style="color:#888">(</span> 
    <span style="color:#b83838">&#34;ABCDEFGHIJKLMabcdefghijklmNOPQRSTUVWXYZnopqrstuvwxyz&#34;</span><span style="color:#888">,</span> 
    <span style="color:#b83838">&#34;NOPQRSTUVWXYZnopqrstuvwxyzABCDEFGHIJKLMabcdefghijklm&#34;</span><span style="color:#888">)</span>
    <span style="color:#2838b0">return</span> string<span style="color:#666">.</span>translate<span style="color:#888">(</span>s<span style="color:#888">,</span> _rot13<span style="color:#888">)</span>

<span style="color:#2838b0">def</span> <span style="color:#785840">b64e</span><span style="color:#888">(</span>s<span style="color:#888">):</span>
    <span style="color:#2838b0">return</span> b64encode<span style="color:#888">(</span>s<span style="color:#888">)</span>

<span style="color:#2838b0">def</span> <span style="color:#785840">caesar</span><span style="color:#888">(</span>plaintext<span style="color:#888">,</span> shift<span style="color:#666">=</span><span style="color:#444">3</span><span style="color:#888">):</span>
    alphabet <span style="color:#666">=</span> string<span style="color:#666">.</span>ascii_lowercase
    shifted_alphabet <span style="color:#666">=</span> alphabet<span style="color:#888">[</span>shift<span style="color:#888">:]</span> <span style="color:#666">+</span> alphabet<span style="color:#888">[:</span>shift<span style="color:#888">]</span>
    table <span style="color:#666">=</span> string<span style="color:#666">.</span>maketrans<span style="color:#888">(</span>alphabet<span style="color:#888">,</span> shifted_alphabet<span style="color:#888">)</span>
    <span style="color:#2838b0">return</span> plaintext<span style="color:#666">.</span>translate<span style="color:#888">(</span>table<span style="color:#888">)</span>

<span style="color:#2838b0">def</span> <span style="color:#785840">encode</span><span style="color:#888">(</span>pt<span style="color:#888">,</span> cnt<span style="color:#666">=</span><span style="color:#444">50</span><span style="color:#888">):</span>
    tmp <span style="color:#666">=</span> <span style="color:#b83838">&#39;2{}&#39;</span><span style="color:#666">.</span>format<span style="color:#888">(</span>b64encode<span style="color:#888">(</span>pt<span style="color:#888">))</span>
    <span style="color:#2838b0">for</span> cnt <span style="color:#a848a8">in</span> <span style="color:#388038">xrange</span><span style="color:#888">(</span>cnt<span style="color:#888">):</span>
        c <span style="color:#666">=</span> random<span style="color:#666">.</span>choice<span style="color:#888">(</span>enc_ciphers<span style="color:#888">)</span>
        i <span style="color:#666">=</span> enc_ciphers<span style="color:#666">.</span>index<span style="color:#888">(</span>c<span style="color:#888">)</span> <span style="color:#666">+</span> <span style="color:#444">1</span>
        _tmp <span style="color:#666">=</span> <span style="color:#388038">globals</span><span style="color:#888">()[</span>c<span style="color:#888">](</span>tmp<span style="color:#888">)</span>
        tmp <span style="color:#666">=</span> <span style="color:#b83838">&#39;{}{}&#39;</span><span style="color:#666">.</span>format<span style="color:#888">(</span>i<span style="color:#888">,</span> _tmp<span style="color:#888">)</span>

    <span style="color:#2838b0">return</span> tmp

<span style="color:#2838b0">if</span> <span style="color:#b85820">__name__</span> <span style="color:#666">==</span> <span style="color:#b83838">&#39;__main__&#39;</span><span style="color:#888">:</span>
    <span style="color:#2838b0">print</span> encode<span style="color:#888">(</span>FLAG<span style="color:#888">,</span> cnt<span style="color:#666">=</span><span style="background-color:#a848a8">?</span><span style="color:#888">)</span>

<span style="color:#444">2</span>Mk16Sk5iakYxVFZoS1RsWnZXbFZaYjFaa1prWm<span style="color:#666">&lt;</span>snip<span style="color:#666">&gt;</span></code></pre></div>
<p>We see that there are three different encryption/encoding routines available - base64 encoding, a caesar cipher, and a rot13 function. Let&rsquo;s dissect the <code>encode</code> function to see if we can figure out what&rsquo;s going on with the input.</p>

<p>It looks like we start off by base64 encoding the input and prepending &ldquo;2&rdquo; to it. Then, as many times as specified (the default is 50), we choose a random function and run it on the current input.</p>

<p>The important line in our reversal is <code>tmp = '{}{}'.format(i, _tmp)</code>. This line prepends the <em>output</em> of the function chosen with the function&rsquo;s <em>index in enc_ciphers + 1</em>. This makes sense, as the index + 1 of the base64 encode function is 2, and that&rsquo;s exactly what we prepend to the initial input before base64 encoding it.</p>

<p>So, in a nutshell here are the corresponding keys:</p>

<ul>
<li>1 - rot13</li>
<li>2 - base64 encode</li>
<li>3 - caesar cipher</li>
</ul>

<p>All we have to do to get the original flag is to reverse this process. We have to start by creating the inverse of our functions. Rot13 is its own inverse, and for Caesar cipher we can just change <code>shift=3</code> to <code>shift=-3</code>. Then, we only have to add the following base64 decode function:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2838b0">def</span> <span style="color:#785840">b64d</span><span style="color:#888">(</span>s<span style="color:#888">):</span>
    <span style="color:#2838b0">return</span> b64decode<span style="color:#888">(</span>s<span style="color:#888">)</span></code></pre></div>
<p>Finally, we just need to put the pieces together to do the reversing. I used the following <code>decode</code> and <code>main</code> functions:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#2838b0">def</span> <span style="color:#785840">decode</span><span style="color:#888">(</span>pt<span style="color:#888">):</span>
	<span style="color:#2838b0">while</span> <span style="color:#b83838">&#34;flag&#34;</span> <span style="color:#a848a8">not</span> <span style="color:#a848a8">in</span> pt<span style="color:#888">:</span>
		i <span style="color:#666">=</span> <span style="color:#388038">int</span><span style="color:#888">(</span>pt<span style="color:#888">[</span><span style="color:#444">0</span><span style="color:#888">])</span>
		raw <span style="color:#666">=</span> pt<span style="color:#888">[</span><span style="color:#444">1</span><span style="color:#888">:]</span>
		<span style="color:#2838b0">print</span> <span style="color:#b83838">&#34;Running function &#34;</span> <span style="color:#666">+</span> dec_ciphers<span style="color:#888">[</span>i<span style="color:#666">-</span><span style="color:#444">1</span><span style="color:#888">]</span>
		_pt <span style="color:#666">=</span> <span style="color:#388038">globals</span><span style="color:#888">()[</span>dec_ciphers<span style="color:#888">[</span>i<span style="color:#666">-</span><span style="color:#444">1</span><span style="color:#888">]](</span>raw<span style="color:#888">)</span>
		pt <span style="color:#666">=</span> _pt
	<span style="color:#2838b0">print</span> pt

<span style="color:#2838b0">if</span> <span style="color:#b85820">__name__</span> <span style="color:#666">==</span> <span style="color:#b83838">&#39;__main__&#39;</span><span style="color:#888">:</span>
	<span style="color:#2838b0">with</span> <span style="color:#388038">open</span><span style="color:#888">(</span><span style="color:#b83838">&#39;csaw_data.txt&#39;</span><span style="color:#888">,</span> <span style="color:#b83838">&#39;r&#39;</span><span style="color:#888">)</span> <span style="color:#2838b0">as</span> raw<span style="color:#888">:</span>
		<span style="color:#2838b0">print</span> decode<span style="color:#888">(</span>raw<span style="color:#666">.</span>read<span style="color:#888">()</span><span style="color:#666">.</span>strip<span style="color:#888">())</span></code></pre></div>
<p>This gives us the following output:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Running function b64d
Running function b64d
Running function caesard
Running function b64d
Running function b64d
Running function b64d
Running function b64d
Running function rot13
Running function b64d
Running function caesard
Running function caesard
Running function caesard
Running function rot13
Running function rot13
Running function rot13
Running function b64d
Running function rot13
Running function rot13
Running function rot13
Running function b64d
Running function caesard
Running function caesard
Running function rot13
Running function b64d
Running function caesard
Running function caesard
Running function caesard
Running function b64d
Running function b64d
Running function b64d
Running function b64d
Running function b64d
Running function caesard
Running function b64d
Running function rot13
Running function rot13
Running function caesard
Running function caesard
Running function caesard
Running function caesard
Running function caesard
Running function caesard
Running function caesard
Running function caesard
Running function b64d
Running function b64d
Running function caesard
Running function caesard
Running function caesard
Running function b64d
Running function rot13
Running function caesard
Running function b64d
Running function caesard
Running function b64d
Running function rot13
Running function caesard
Running function rot13
Running function caesard
Running function caesard
Running function b64d
flag{li0ns_and_tig3rs_4nd_b34rs_0h_mi}</code></pre></div>
<p>There&rsquo;s the flag! <code>flag{li0ns_and_tig3rs_4nd_b34rs_0h_mi}</code></p>

<p>Jordan (<a href="https://twitter.com/jw_sec">@jw_sec</a>)</p>
    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://jordan-wright.com/blog/" style="background-image: url(https://jordan-wright.com/blog/images/jordan-profile.jpg)"><span class="hidden">Jordan Wright's Picture</span></a>
    </figure>
    

    





<section class="author">
  <h4><a href="https://jordan-wright.com/blog/">Jordan Wright</a></h4>
  
  <p>Security Researcher, Programmer.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">San Antonio, Texas</span>
    
  </div>
</section>



    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=CSAW%20CTF%202015%20-%20Forensics%20100%20Transfer%20Writeup&nbsp;-&nbsp;Jordan%20Wright&amp;url=https%3a%2f%2fjordan-wright.com%2fblog%2f2015%2f09%2f22%2fcsaw-ctf-2015-forensics-100-transfer-writeup%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fjordan-wright.com%2fblog%2f2015%2f09%2f22%2fcsaw-ctf-2015-forensics-100-transfer-writeup%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fjordan-wright.com%2fblog%2f2015%2f09%2f22%2fcsaw-ctf-2015-forensics-100-transfer-writeup%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'jordan-wright';
  var disqus_url = 'https:\/\/jordan-wright.com\/blog\/2015\/09\/22\/csaw-ctf-2015-forensics-100-transfer-writeup\/';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Jordan Wright</a> </section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://jordan-wright.com/blog/js/jquery.js"></script>
    <script type="text/javascript" src="https://jordan-wright.com/blog/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://jordan-wright.com/blog/js/index.js"></script>
    
</body>
</html>

