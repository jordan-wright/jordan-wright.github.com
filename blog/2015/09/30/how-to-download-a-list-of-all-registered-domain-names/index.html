<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="og:title" content="How to Download a List of All Registered Domain Names &#183; Jordan Wright"><meta property="og:site_name" content="Jordan Wright"><meta property="og:url" content="https://jordan-wright.com/blog/2015/09/30/how-to-download-a-list-of-all-registered-domain-names/"><meta property="og:type" content="article"><meta property="og:article:published_time" content="2015-09-30T00:00:00Z"><meta property="og:article:tag" content="tutorial"><meta property="og:article:tag" content="dns"><title>How to Download a List of All Registered Domain Names &#183; Jordan Wright</title><meta name=description content="Security and Programming Blog"><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://jordan-wright.com/blog/images/favicon.ico><link rel=apple-touch-icon href=https://jordan-wright.com/blog/images/apple-touch-icon.png><link rel=stylesheet type=text/css href=https://jordan-wright.com/blog/css/screen.css><link rel=stylesheet type=text/css href=https://jordan-wright.com/blog/css/highlight.css><link rel=stylesheet type=text/css href=https://jordan-wright.com/blog/css/nav.css><link rel=stylesheet type=text/css href=https://jordan-wright.com/blog/css/fonts.css><link href=https://jordan-wright.com/blog/index.xml rel=alternate type=application/rss+xml title="Jordan Wright"><meta name=generator content="Hugo 0.154.5"><link rel=canonical href=https://jordan-wright.com/blog/2015/09/30/how-to-download-a-list-of-all-registered-domain-names/><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-44718701-1","auto"),ga("send","pageview")</script></head><body class=nav-closed><div class=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Close</span></a><ul><li class=nav-opened role=presentation><a href=https://jordan-wright.com/>Home</a></li><li class=nav-opened role=presentation><a href=https://jordan-wright.com/contact/>Contact</a></li><li class=nav-opened role=presentation><a href=https://jordan-wright.com/projects/>Projects</a></li><li class=nav-opened role=presentation><a href=https://jordan-wright.com/blog/>Blog</a></li><li class=nav-opened role=presentation><a href=https://raidersec.blogspot.com>Raidersec</a></li></ul><a class="subscribe-button icon-feed" href=https://jordan-wright.com/blog/index.xml>Subscribe</a></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head no-cover"><nav class="main-nav clearfix"><a class=menu-button href=#><span class=burger>&#9776;</span><span class=word>Menu</span></a></nav></header><main class=content role=main><article class="post post"><header class=post-header><h1 class=post-title>How to Download a List of All Registered Domain Names</h1><small></small><section class=post-meta><time class=post-date datetime=2015-09-30T00:00:00Z>Sep 30, 2015
</time><span class="post-tag small"><a href=https://jordan-wright.com/blog/tags/tutorial/>#tutorial</a></span>
<span class="post-tag small"><a href=https://jordan-wright.com/blog/tags/dns/>#dns</a></span></section></header><section class=post-content><img src=/blog/images/headers/download_domains.png alt class=pure-img><h3 id=introduction>Introduction</h3><p>Every morning, the infosec field is greeted with an onslaught of freshly registered malicious domains. These domains are used to host phishing sites, maintain botnet command and control, harvest stolen information, and more.</p><p>Having the complete list of registered domains day-by-day offers substantial visibility that can be used for intel and repsonse. Fortunately, such lists not only exist, but are available (usually for free!) with little effort involved. This post will introduce TLD zone files, how to access them, and how they can be used to your benefit.</p><h3 id=zone-files>Zone Files</h3><p>Before being swamped with domains, let&rsquo;s talk a little about how these lists of domains are organized. Someone has to keep track of all the domains for a certain TLD (.com, .net, .ninja, etc.). These are called the <em>registries</em>. Each registry maintains a master list of all the domains they are responsible for. This master list is called a &ldquo;<a href=https://en.wikipedia.org/wiki/Zone_file>zone file</a>&rdquo;.</p><p>It&rsquo;s the registry&rsquo;s responsibility to maintain this zone file. As you can imagine, the zone file for TLD&rsquo;s updates many times a day as new domains are registered, other domains expire, and nameserver records are changed.</p><h3 id=i-just-want-to-download-the-data>I Just Want to Download the Data!</h3><p>So we know what zone files are for, but how do we access them? As mentioned before, each registry is responsible for maintaining the zone file for their TLD, but they are also responsible for maintaining <em>access to</em> the zone file. This means that in some cases we&rsquo;ll need to go directly to the registrar, but there are some helpful exceptions.</p><h4 id=com-net-and-name>.COM, .NET, and .NAME</h4><p>Let&rsquo;s start with the most obvious ones: .com, .net, and .name (since it&rsquo;s bundled). These are maintained by Verisign. <a href=https://www.verisign.com/en_US/channel-resources/domain-registry-products/zone-file/index.xhtml>Access to these zone files</a> consists of downloading a <a href=https://www.verisign.com/assets/VRSN_zonefile_access_request_form_201208.dotx>Zone Access Form</a> and emailing the completed form to <code>tldzone@verisign-grs.com</code>.</p><p>It took a couple of weeks for this access to be granted. After your form is approved, you will receive FTP credentials that can be used to download the zone files daily.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>root@tld:~# ftp rz.verisign-grs.com
</span></span><span class=line><span class=cl>Connected to rz.verisign-grs.com.
</span></span><span class=line><span class=cl>220-**** Welcome to the VeriSign Global Registry Services gTLD Zone FTP Server ****
</span></span><span class=line><span class=cl>220-***
</span></span><span class=line><span class=cl>220-*** This computer system is owned and operated by VeriSign, Inc.
</span></span><span class=line><span class=cl>220-*** All software or information that you access or download from this
</span></span><span class=line><span class=cl>220-*** server is being licensed to you under the terms of our Registrar
</span></span><span class=line><span class=cl>220-*** License and Agreement.  Unauthorized access to this system may
</span></span><span class=line><span class=cl>220-*** result in criminal prosecution.
</span></span><span class=line><span class=cl>220-***
</span></span><span class=line><span class=cl>220-*** All sessions established with this server are monitored and logged.
</span></span><span class=line><span class=cl>220-*** Disconnect now if you do not consent to having your actions monitored
</span></span><span class=line><span class=cl>220-*** and logged.
</span></span><span class=line><span class=cl>220-***
</span></span><span class=line><span class=cl>220-******!
</span></span><span class=line><span class=cl>220
</span></span><span class=line><span class=cl>Name: [redacted]
</span></span><span class=line><span class=cl>331 Please specify the password.
</span></span><span class=line><span class=cl>Password:
</span></span><span class=line><span class=cl>230 Login successful.
</span></span><span class=line><span class=cl>Remote system type is UNIX.
</span></span><span class=line><span class=cl>Using binary mode to transfer files.
</span></span><span class=line><span class=cl>ftp&gt; ls
</span></span><span class=line><span class=cl>200 PORT command successful. Consider using PASV.
</span></span><span class=line><span class=cl>150 Here comes the directory listing.
</span></span><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>-rw-r--r--    1 ftp      ftp      2497503218 Sep 29 15:20 com.zone.gz
</span></span><span class=line><span class=cl>-rw-r--r--    1 ftp      ftp      321976673 Sep 29 15:12 net.zone.gz
</span></span><span class=line><span class=cl>226 Directory send OK.
</span></span></code></pre></div><p>We&rsquo;ll take a look at what we can do with these soon. First, let&rsquo;s talk about how we can catch all that malware on <code>.ninja</code>.</p><h4 id=the-centralized-zone-data-service-czds>The Centralized Zone Data Service (CZDS)</h4><p>You&rsquo;ve likely noticed that there are a <em>ton</em> of new gTLDs appearing. At the time of this writing, there are <a href=https://www.iana.org/domains/root/db>1070 valid and sponsored TLDs</a> approved by the IANA - a department of ICANN.</p><p>Since each registry maintains its own zone file, it&rsquo;s overwhelming to try to get access to all of them separately. Fortunately, ICANN solved this problem by creating the Centralized Zone Data Service (CZDS).</p><p>CZDS &ldquo;provides a centralized access point&mldr; to the Zone Files provided by participating Top Level Domains&rdquo;. This means that, by registering with CZDS, we can simultaneously request access to most of the TLD (including those gTLDs) zone files.</p><img src=/blog/images/blog/download_domains/czds.png><p>When you get access to a particular zone file, you&rsquo;re able to download it via <a href=https://czds.icann.org/en/help/api-access>ICANN&rsquo;s API</a>. They even provide a <a href=https://github.com/fourkitchens/czdap-tools>Python client</a> that can be used to bulk download all the zone files you have access to.</p><p>Unfortunately, you may not get access to all zone files. In fact, looking at <a href=https://czdap.icann.org/en/reports>the most recent report</a> released by ICANN, TLDs such as <code>.aaa</code> only have <strong>3</strong> people authorized to use CZDS to download the zone file. We&rsquo;ll work with what we have, I suppose.</p><p>Ok, we have enough data. Let&rsquo;s start parsing.</p><h3 id=parsing-zone-files>Parsing Zone Files</h3><p>If you want to parse everything about the zone files, you can read about the full format in <a href=https://tools.ietf.org/html/rfc1035>RFC 1035</a>, but this post is only interested in the domain -> nameserver mappings. So, let&rsquo;s just start by taking a look at the contents of the file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>root@tld:~# head com.zone -n 50
</span></span><span class=line><span class=cl>; The use of the Data contained in Verisign Inc.&#39;s aggregated
</span></span><span class=line><span class=cl>; .com, and .net top-level domain zone files (including the checksum
</span></span><span class=line><span class=cl>; files) is subject to the restrictions described in the access Agreement
</span></span><span class=line><span class=cl>; with Verisign Inc.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ORIGIN COM.
</span></span><span class=line><span class=cl>$TTL 900
</span></span><span class=line><span class=cl>@ IN    SOA     a.gtld-servers.net. nstld.verisign-grs.com. (
</span></span><span class=line><span class=cl>                                  1443370544 ;serial
</span></span><span class=line><span class=cl>                                  1800 ;refresh every 30 min
</span></span><span class=line><span class=cl>                                  900 ;retry every 15 min
</span></span><span class=line><span class=cl>                                  604800 ;expire after a week
</span></span><span class=line><span class=cl>                                  86400 ;minimum of a day
</span></span><span class=line><span class=cl>                                  )
</span></span><span class=line><span class=cl>$TTL 172800
</span></span><span class=line><span class=cl> NS A.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS G.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS H.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS C.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS I.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS B.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS D.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS L.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS F.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS J.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS K.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS E.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl> NS M.GTLD-SERVERS.NET.
</span></span><span class=line><span class=cl>COM. 86400 DNSKEY 257 3 8 AQPD&lt;snip&gt;
</span></span><span class=line><span class=cl>COM. 86400 DNSKEY 256 3 8 AQOp&lt;snip&gt;
</span></span><span class=line><span class=cl>COM. 86400 NSEC3PARAM 1 0 0 -
</span></span><span class=line><span class=cl>COM. 900 RRSIG SOA 8 1 900 20151004161544 20150927150544 35864 COM. MpW&lt;snip&gt;
</span></span><span class=line><span class=cl>COM. RRSIG NS 8 1 172800 20151003045209 20150926034209 35864 COM. mcxl&lt;snip&gt;
</span></span><span class=line><span class=cl>COM. 86400 RRSIG NSEC3PARAM 8 1 86400 20151003045209 20150926034209 35864 COM. SLk71&lt;snip&gt;
</span></span><span class=line><span class=cl>COM. 86400 RRSIG DNSKEY 8 1 86400 20150930182533 20150923182033 30909 COM. pDtt&lt;snip&gt;
</span></span><span class=line><span class=cl>KITCHENEROKTOBERFEST NS NS1.HOSTINGNET
</span></span><span class=line><span class=cl>KITCHENEROKTOBERFEST NS NS2.HOSTINGNET
</span></span><span class=line><span class=cl>KITCHENFLOORTILE NS NS1.HOSTINGNET
</span></span></code></pre></div><p>The first 35 lines of the file include some information about the zone file, the root name servers, etc. The actual meat of the file starts on line 36.</p><p>Typically, zone files contain lines that have the following format:</p><ul><li>Name</li><li>TTL</li><li>Record Class</li><li>Record Type</li><li>Record Data</li></ul><p>In our example, we see that <code>KITCHENROKTOBERFEST.COM</code> (the .com is understood) points to the name servers at <code>NS1.HOSTINGNET.COM</code> and <code>NS2.HOSTINGNET.COM</code>.</p><p>In addition to lines showing how domain names map to nameservers, at the bottom of the file we have the A records (IP addresses) for each name server in the file. But what if we want to remove all the &ldquo;fluff&rdquo; and only keep the lines showing which domains map to which nameservers?</p><p>We can grab the &ldquo;interesting&rdquo; lines using a simple <code>grep -E "^[a-zA-Z0-9-]+ NS ." com.zone</code>, which will give us only the lines with domains pointing to nameservers.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>root@tld:~# grep -E &#34;^[a-zA-Z0-9-]+ NS .&#34; com.zone | head -n 10
</span></span><span class=line><span class=cl>KITCHENEROKTOBERFEST NS NS1.HOSTINGNET
</span></span><span class=line><span class=cl>KITCHENEROKTOBERFEST NS NS2.HOSTINGNET
</span></span><span class=line><span class=cl>KITCHENFLOORTILE NS NS1.HOSTINGNET
</span></span><span class=line><span class=cl>KITCHENFLOORTILE NS NS2.HOSTINGNET
</span></span><span class=line><span class=cl>KITCHENTABLESET NS NS1.HOSTINGNET
</span></span><span class=line><span class=cl>KITCHENTABLESET NS NS2.HOSTINGNET
</span></span><span class=line><span class=cl>KITEPICTURES NS NS1.HOSTINGNET
</span></span><span class=line><span class=cl>KITEPICTURES NS NS2.HOSTINGNET
</span></span><span class=line><span class=cl>BOYSBOXERS NS NS1.HOSTINGNET
</span></span><span class=line><span class=cl>BOYSBOXERS NS NS2.HOSTINGNET
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@tld:~# grep -E &#34;^[a-zA-Z0-9-]+ NS .&#34; com.zone | wc -l
</span></span><span class=line><span class=cl>281899907
</span></span></code></pre></div><p><strong>Awesome.</strong> We can parse this output to do anything we want with our list of domains.</p><h3 id=conclusion>Conclusion</h3><p>There are a <em>ton</em> of use cases for this data in terms of information security, such as typo-squat monitoring, DGA monitoring, bit flip monitoring, etc.
However, while this is an infosec blog, zone files can be used for far more than that. It could be used to detect name trends, watch for certain keywords, and more.</p><p>Now, consider what would happen if you kept a version controlled <em>diff</em> of this data every day. That would allow you to see trends over time or, for infosec, watch how domains change. Domain move behind Cloudflare/Akamai? You&rsquo;ll have a record of what nameserver they pointed to before the move.</p><p>I hope this sheds some light on not only how useful zone files are, but also how <strong>accessible</strong> they are. ICANN, Verisign, and other registries deserve credit for making this data available to the public.</p><p>As always, let me know if you have questions/comments.</p><p>-Jordan (<a href=https://twitter.com/jw_sec>@jw_sec</a>)</p></section><footer class=post-footer><figure class=author-image><a class=img href=https://jordan-wright.com/blog/ style=background-image:url(https://jordan-wright.com/blog/images/jordan-profile.jpg)><span class=hidden>Jordan Wright's Picture</span></a></figure><section class=author><h4><a href=https://jordan-wright.com/blog/>Jordan Wright</a></h4><p>Security Researcher, Open-Source Developer.</p><div class=author-meta><span class="author-location icon-location">Texas</span></div></section><section class=share><h4>Share this post</h4><a class=share-link href="https://twitter.com/intent/tweet?text=How%20to%20Download%20a%20List%20of%20All%20Registered%20Domain%20Names&nbsp;-&nbsp;Jordan%20Wright&amp;url=https%3a%2f%2fjordan-wright.com%2fblog%2f2015%2f09%2f30%2fhow-to-download-a-list-of-all-registered-domain-names%2f" onclick='return window.open(this.href,"x-share","width=550,height=235"),!1'><svg class="share-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M18.244 2.25h3.308l-7.227 8.26 8.503 11.24h-6.68l-5.23-6.84-6.02 6.84H1.59l7.73-8.812L1.16 2.25h6.85l4.73 6.25 5.504-6.25zm-1.16 17.52h1.833L6.71 4.126H4.745L17.084 19.77z"/></svg>
<span class=hidden>X</span>
</a><a class=share-link href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fjordan-wright.com%2fblog%2f2015%2f09%2f30%2fhow-to-download-a-list-of-all-registered-domain-names%2f&amp;t=How%20to%20Download%20a%20List%20of%20All%20Registered%20Domain%20Names" onclick='return window.open(this.href,"hn-share","width=600,height=400"),!1'><svg class="share-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path fill-rule="evenodd" d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
<span class=hidden>Hacker News</span>
</a><a class=share-link href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fjordan-wright.com%2fblog%2f2015%2f09%2f30%2fhow-to-download-a-list-of-all-registered-domain-names%2f" onclick='return window.open(this.href,"linkedin-share","width=600,height=500"),!1'><svg class="share-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.6.0 4.264 2.37 4.264 5.455v6.286zM5.337 7.433a2.062 2.062.0 110-4.123 2.062 2.062.0 010 4.123zM6.814 20.452H3.861V9h2.953v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0z"/></svg>
<span class=hidden>LinkedIn</span></a></section></footer></article></main></div><script type=text/javascript src=https://jordan-wright.com/blog/js/jquery.js defer></script><script type=text/javascript src=https://jordan-wright.com/blog/js/index.js defer></script></body></html>